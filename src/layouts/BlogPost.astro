---
import type { CollectionEntry } from "astro:content";
import type { MarkdownHeading } from "astro";
import BaseHead from "../components/BaseHead.astro";
import Footer from "../components/Footer.astro";
import FormattedDate from "../components/FormattedDate.astro";

type Props = CollectionEntry<"blog">["data"] & {
  readTime?: number;
  headings?: MarkdownHeading[];
};

const {
  title,
  description,
  heroImage,
  readTime,
  authorName,
  authorImage,
  authorDesignation,
  pubDate,
  headings = [],
} = Astro.props;

// Filter to only h2 and h3 headings for TOC
const tocHeadings = headings.filter((h) => h.depth === 2 || h.depth === 3);
---

<html lang="en">
  <head>
    <BaseHead title={title} description={description} />
  </head>

  <body>
    <main class="max-w-7xl mx-auto px-4">
      <article class="flex flex-col gap-12">
        <!-- Hero Section -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-10 items-center">
          <div class="flex flex-col gap-4">
            <h1 class="m-0 mb-2 text-4xl lg:text-5xl!">{title}</h1>
            <div class="flex items-center gap-4">
              {
                authorImage && (
                  <img
                    src={authorImage}
                    width={60}
                    height={100}
                    alt={authorName}
                    class="rounded-full!"
                  />
                )
              }
              <div class="flex flex-col">
                <span class="text-base">{authorName}</span>
                <span class="text-base text-neutral-500"
                  >{authorDesignation}</span
                >
              </div>
            </div>
            <div class="flex items-center gap-3">
              <FormattedDate date={pubDate} />
              <span class="w-0.5 h-3 rounded-full bg-neutral-900"></span>
              {readTime && <span class="text-base">{readTime} min read</span>}
            </div>
          </div>
          {
            heroImage && (
              <img
                src={heroImage}
                alt={title}
                class="block mx-auto rounded-xl"
              />
            )
          }
        </div>

        <div class="flex gap-14">
          {
            tocHeadings.length > 0 && (
              <aside class="hidden lg:block w-64 shrink-0">
                <nav class="sticky top-8">
                  <h2 class="text-base! font-semibold text-neutral-900 mb-4! uppercase tracking-wide">
                    Table of Contents
                  </h2>
                  <ul class="space-y-2 text-base">
                    {tocHeadings.map((heading) => (
                      <li class={heading.depth === 4 ? "pl-8" : ""}>
                        <a
                          href={`#${heading.slug}`}
                          class="text-neutral-600! hover:text-neutral-900! transition-colors hover:underline block py-1"
                        >
                          {heading.text}
                        </a>
                      </li>
                    ))}
                  </ul>
                </nav>
              </aside>
            )
          }

          <div class="prose prose-base max-w-none flex-1">
            <slot />
          </div>
        </div>
      </article>
    </main>
    <Footer />
  </body>
</html>
